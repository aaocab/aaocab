var PACObject={_object:{},getObject:function(d){return this._object[d]},setObject:function(d,g){this._object[d]=g}},txtFields,placeAutoComplete=function(d,g,f){txtFields=d;this.model={};void 0!==f&&null!==f&&(PACObject.setObject(f,this),this.model.controlId=f);this.model.displayField=document.getElementById(d);this.model.valueField=$("#"+g+".hdn"+this.model.controlId)[0];this.model.placeObj='{"coordinates": {}}';this.geocode=this.box=null;this.selected=!1;this.model.defaultOptions=JSON.stringify({types:[],
fields:["place_id"],strictBounds:1,componentRestrictions:{country:"IN"}});var b=this;$(this.model.displayField).on("focus",function(){b.selected=!0});$(this.model.displayField).on("blur",function(){b.selected||b.model.displayValue===b.model.displayField.value||b.clear()});$(this.model.displayField).on("keypress",function(a){if(13==(a.keyCode||a.which))return!1});this.initControl=function(a){this.model.options=a;this.model.displayValue=this.model.displayField.value;this.clear();this.enable();this.removePAC();
this.model.autocomplete=new google.maps.places.Autocomplete(this.model.displayField,a);var c=this;google.maps.event.addListener(this.model.autocomplete,"place_changed",function(){c.processValue()});$(this.model.valueField).trigger("load",[this])};this.setValue=function(a,c=!1){if(void 0!==a&&""!=a){if(a.constructor==="test".constructor)try{a=JSON.parse(a)}catch(e){return!1}this.model.displayField.value=a.address;this.model.valueField.value=JSON.stringify(a);this.model.displayValue=this.model.displayField.value;
c||$(this.model.displayField).trigger("placechange",[this])}};this.getValueObject=function(){var a=this.model.valueField.value;if(void 0!==a&&""!==a&&a.constructor==="test".constructor)try{a=JSON.parse(a)}catch(c){return!1}return a};this.processValue=function(){this.selected=!0;this.model.displayValue=this.model.displayField.value;var a=JSON.parse(this.model.placeObj);this.model.googlePlaceObject=this.model.autocomplete.getPlace();a.address=this.model.displayValue;a.place_id=this.model.googlePlaceObject.place_id;
a=this.getgeo(a);a.coordinates||(this.model.displayField.value="Sorry! Address not found",this.model.valueField.value="");this.model.valueField.value=JSON.stringify(a);$(this.model.displayField).trigger("placechange",[this])};this.getgeo=function(a){let c=this.model;$.ajax({async:!1,type:"POST",url:$baseUrl+"/lookup/getPlace",dataType:"json",data:{place:a},success:function(e){a=e.data;a.address=c.displayField.value},error:function(a){console.log(a)}});return a};this.focus=function(){this.model.displayField.focus()};
this.clear=function(){this.model.displayField.value="";this.model.valueField.value=""};this.disable=function(){this.model.displayField.readOnly=!0};this.enable=function(){this.model.displayField.readOnly=!1};this.removePAC=function(){void 0!=this.model.autocomplete&&google.maps.event.clearInstanceListeners(this.model.autocomplete)};this.getPlaceObject=function(){return JSON.parse(this.model.valueField.value)};this.getGooglePlaceObject=function(){return this.model.googlePlaceObject};this.onPlaceChange=
function(a){$(this.model.displayField).on("placechange",a)};this.onLoad=function(a){$(this.model.valueField).on("load",a)};this.bindOnClick=function(){this.model.displayField.readonly=!0;$(this.model.displayField).unbind("click").on("click",function(){b.openMobileMap()})};this.validateAddress=function(a){a=this.isPreciseLocation();a||(alert("Please enter proper street/building/point address"),this.clear(),this.focus());return a};this.isPreciseLocation=function(){var a=!1,c="locality administrative_area_level_3 administrative_area_level_2 administrative_area_level_1 country postal_code".split(" ");
let e=this.getPlaceObject();if(void 0!==e.types){a=!0;var b=e.types;c.every(function(c){0<=b.indexOf(c)&&(a=!1);return a})}a||(a=(c=this.calculateArea(e.bounds))&&2>c);return a};this.openGeocodeMarker=function(){var a=JSON.parse(this.model.placeObj);try{a=JSON.parse(this.model.valueField.value)}catch(e){}this.openMobileMap();var c=null;void 0!==this.model.options&&null!==this.model.options&&(c=this.model.options.bounds);this.geocode=new geocodeMarker(a,c,document.getElementById("map"+b.model.controlId));
this.geocode.initMap()};this.showMapBox=function(){null!==this.box?this.box.addClass("show").css("display","block"):this.box=bootbox.dialog({title:"",message:'<h4>Select Precise Location</h4><div id="map'+b.model.controlId+'" style="min-height: 500px"></div>',size:"large",onEscape:function(){b.box.modal("hide");b.box.css("display","none");$(".modal-backdrop").remove();$("body").removeClass("modal-open")},buttons:{submit:{label:"Save Location",className:"btn-success",callback:function(){b.model.googlePlaceObject=
b.geocode.model.googlePlaceObject;b.setValue(b.geocode.model.placeObj);b.box.modal("hide");b.box.css("display","none");$(".modal-backdrop").remove();$("body").removeClass("modal-open")}}}}).addClass("show").css("display","block")};this.openMobileMap=function(){null!=this.model.options&&$.ajax({type:"GET",url:"/booking/autoMarkerAddress",data:{},dataType:"HTML",success:function(a){$("#map-marker-content").html(a);$(document).ready(function(){initMap(b)});$("#booknow-map-marker").click()}})};this.getAirportBounds=
function(a,c){var e=a-0+.25;var b=c-0+.25;return new google.maps.LatLngBounds(new google.maps.LatLng(a-.25,c-.25),new google.maps.LatLng(e,b))};this.initAirportBounds=function(a){""===a?(this.clear(),this.model.options=null,this.disable()):(new City).getDetails(a,function(a){a=b.getAirportBounds(a.coordinates.latitude,a.coordinates.longitude);var c=JSON.parse(b.model.defaultOptions);c.bounds=a;b.initControl(c)})};this.calculateArea=function(a){var c=new google.maps.LatLng(a.northeast.lat,a.northeast.lng);
a=new google.maps.LatLng(a.southwest.lat,a.southwest.lng);var b=new google.maps.LatLng(c.lat(),a.lng());c=new google.maps.LatLng(a.lat(),c.lng());b=this.calculateDistance(a,b);a=this.calculateDistance(a,c);return b*a};this.calculateDistance=function(a,c){var b=a.lat(),d=a.lng();a=c.lat();var f=c.lng();c=Math.PI/180*(a-b);d=Math.PI/180*(f-d);b=Math.sin(c/2)*Math.sin(c/2)+Math.cos(Math.PI/180*b)*Math.cos(Math.PI/180*a)*Math.sin(d/2)*Math.sin(d/2);return 12742*Math.atan2(Math.sqrt(b),Math.sqrt(1-b))};
this.goSelect=function(a){alert(a)};this.getAddressForm=function(){$(".modal").modal("hide");var a=this.model.valueField.value,b=this.model.googlePlaceObject.geometry.location.lat(),d=this.model.googlePlaceObject.geometry.location.lng(),f=JSON.parse(this.model.valueField.value).address;$.ajax({type:"GET",url:"/booking/addressForm",data:{mapContent:a,lat:b,long:d,address:f},dataType:"HTML",success:function(a){$("#bkCommonModel").removeClass("fade");$("#bkCommonModel").css("display","block");$("#bkCommonModelBody").html(a);
$("#bkCommonModel").modal("show")}})}};