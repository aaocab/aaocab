

UPDATE booking bkg JOIN  
(
select bcb_id,bcb_bkg_id1,bcb_active from booking_cab where bcb_active=1
) bcb ON bkg.bkg_id = bcb.bcb_bkg_id1 AND bkg.bkg_status = 2  AND bkg.bkg_bcb_id IS NULL
set bkg_bcb_id = bcb.bcb_id


UPDATE booking_route brt JOIN  
(
select bkg_id,bkg_bcb_id,bkg_status from booking where bkg_status=2
) bkg ON bkg.bkg_id = brt.brt_bkg_id AND brt.brt_active = 1  AND brt.brt_bcb_id IS NULL
set brt.brt_bcb_id = bkg.bkg_bcb_id

UPDATE booking_vendor_request bvr JOIN  
(
select bkg_id,bkg_bcb_id,bkg_status from booking
) bkg ON bkg.bkg_id = bvr.bvr_booking_id
set bvr.bvr_bcb_id = bkg.bkg_bcb_id 


  
update booking_cab set bcb_pending_status = 0
    


select * from booking_cab where bcb_pending_status = 2;

select * from booking where bkg_status = 2


select * from booking_cab bcb join booking bkg on bkg.bkg_id = bcb.bcb_bkg_id1 where bkg.bkg_status = 2  AND bkg.bkg_bcb_id IS NULL

select * from booking_route brt join booking bkg ON bkg.bkg_id = brt.brt_bkg_id where bkg.bkg_status = 2 AND brt.brt_active = 1 
AND brt.brt_bcb_id IS NULL



update booking set bkg_bcb_id = NULL where bkg_status = 2 



insert into booking_cab (bcb_bkg_id1,bcb_pending_status,bcb_vendor_amount) SELECT bkg_id,2,bkg_vendor_amount FROM booking where ((bkg_status = 2) OR bkg_pickup_date>now() OR bkg_id IN (SELECT DISTINCT(bvr_booking_id) FROM booking_vendor_request)) AND bkg_id NOT IN (SELECT bcb_bkg_id1 FROM booking_cab WHERE bcb_active=1)



update booking join (select bcb_id,bcb_pending_status,bcb_bkg_id1,bcb_active from booking_cab where bcb_active=1 and bcb_pending_status=2) bcb on bcb.bcb_bkg_id1=booking.bkg_id set bkg_bcb_id=bcb.bcb_id
